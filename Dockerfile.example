# ParaBank Application Docker Configuration
# This Dockerfile builds and runs the ParaBank application in a container

FROM tomcat:9.0-jdk17-openjdk-slim

# Set environment variables
ENV CATALINA_HOME /usr/local/tomcat
ENV PATH $CATALINA_HOME/bin:$PATH

# Install curl for health checks
RUN apt-get update && \
    apt-get install -y curl && \
    rm -rf /var/lib/apt/lists/*

# Create a directory for ParaBank
WORKDIR $CATALINA_HOME/webapps

# Copy ParaBank WAR file (if building from local)
# COPY target/parabank-0.0.1-SNAPSHOT.war ./ROOT.war

# Alternative: If you want to download from a repository or use existing
# You can modify this to pull from your build artifacts

# Remove default ROOT application
RUN rm -rf ROOT

# Download ParaBank if available from a repository
# RUN curl -L "URL_TO_PARABANK_WAR" -o ROOT.war

# Expose port 8080
EXPOSE 8080

# Set working directory back to CATALINA_HOME
WORKDIR $CATALINA_HOME

# Add health check
HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \
    CMD curl -f http://localhost:8080/ || exit 1

# Start Tomcat
CMD ["catalina.sh", "run"]

